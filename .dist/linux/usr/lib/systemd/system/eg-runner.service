[Unit]
Description=eg runner container
After=network.target

[Service]
ProtectKernelTunables=true
ProtectKernelModules=yes
PrivateMounts=yes
IPAddressDeny=link-local
IPAddressDeny=multicast
Restart=on-failure
CacheDirectory=%p
ConfigurationDirectory=%p
RuntimeDirectory=%p
RuntimeDirectoryMode=0700
Environment=EG_RUNNER_CPU=2
Environment=EG_RUNNER_MEMORY=2g
Environment=EG_RUNNER_OVERRIDE_DIR=rootfs
EnvironmentFile=-/etc/eg/runner.env
ExecStartPre=/usr/bin/podman build --build-arg EG_RUNNER_OVERRIDE_DIR="${EG_RUNNER_OVERRIDE_DIR}" -t eg-runner -f /usr/share/eg/Containerfile /usr/share/eg
ExecStart=/usr/bin/podman run --attach STDERR --no-healthcheck --cpus ${EG_RUNNER_CPU} --memory ${EG_RUNNER_MEMORY} eg-runner:latest /sbin/init

[Install]
WantedBy=default.target
