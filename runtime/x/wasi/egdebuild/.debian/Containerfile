FROM ubuntu:questing
ARG DEBIAN_FRONTEND=noninteractive

RUN echo "cache buster 059a9a06-1686-4f49-9a7f-a30535886d68"
RUN apt-get update
RUN apt-get install -y software-properties-common build-essential ca-certificates curl sudo podman netavark rsync vim dput devscripts dh-make dput git uidmap dbus-user-session tree python3 python3-venv
RUN add-apt-repository -n ppa:longsleep/golang-backports
RUN add-apt-repository -n ppa:egdaemon/eg
RUN add-apt-repository -n ppa:egdaemon/duckdb

RUN apt-get update
RUN apt-get -y install golang-1.25 eg egbootstrap
# temporary hack until egbootstrap is updated.
RUN echo "%wheel ALL=(ALL:ALL) SETENV: NOPASSWD: ALL" > /etc/sudoers.d/egd
# required until we update the shell to explicitly pass all env keys instead of using -E
RUN update-alternatives --set sudo /usr/bin/sudo.ws

RUN ln -s /usr/lib/go-1.23/bin/go /usr/local/bin/go

RUN systemd-sysusers
RUN systemd-tmpfiles --create
